#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "im running"

message_file=$1
message=$(cat $message_file)
# trim message
message=$(echo "$message" | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//')

get_type(){
  delimiter=":"
  index=0

  type=$(echo "$message" | cut -d "$delimiter" -f "$((index+1))")

  echo "$type"
}

type=$(get_type)

# message with emoji

# if type has en emoji exit with status 0
if echo "$type" | grep -P '[^\x00-\x7F]' > /dev/null; then
  exit 0
fi

# message without emoji
type=$(get_type)
emoji=""

case $type in "build")
  emoji="ðŸ”§"
  ;;
  "chore")
  emoji="ðŸ³"
  ;;
  "ci")
  emoji="ðŸŽ"
  ;;
  "docs")
  emoji="ðŸ“ƒ"
  ;;
  "feat")
  emoji="âœ¨"
  ;;
  "fix")
  emoji="ðŸž"
  ;;
  "perf")
  emoji="ðŸŽˆ"
  ;;
  "refactor")
  emoji="ðŸ¦„"
  ;;
  "revert")
  emoji="â†©"
  ;;
  "style")
  emoji="ðŸŒˆ"
  ;;
  "test")
  emoji="ðŸ§ª"
  ;;
esac

result="${emoji} ${message}"
# trim result message
result=$(echo "$result" | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//')

echo "output::"
echo "$result"

echo "${result}" > $message_file
